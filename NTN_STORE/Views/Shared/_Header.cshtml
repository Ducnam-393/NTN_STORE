@using Microsoft.AspNetCore.Identity
@inject UserManager<IdentityUser> UserManager
@inject SignInManager<IdentityUser> SignInManager

<style>
    /* --- HEADER STYLES --- */
    .header-top {
        background-color: #f8f9fa;
        font-size: 12px;
        color: #666;
        border-bottom: 1px solid #eee;
    }

    .header-main {
        background: #fff;
        padding: 15px 0;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        /* FIX LỖI BỊ CHE 1: Đặt vị trí sticky và z-index cực cao để đè lên Navbar/Slider bên dưới */
        position: sticky;
        top: 0;
        z-index: 1090 !important; /* Navbar thường là 1030, Modal là 1050 -> Ta đặt 1090 */
    }

    /* Search Bar */
    .search-wrap {
        position: relative;
        width: 100%;
        max-width: 600px;
        margin: 0 auto;
    }

    .search-box {
        width: 100%;
        height: 42px;
        border: 2px solid #eee;
        border-radius: 50px;
        padding: 0 50px 0 20px;
        background: #f8f9fa;
        transition: all 0.3s;
        outline: none;
    }

        .search-box:focus {
            background: #fff;
            border-color: #f58220;
        }

    .search-btn-icon {
        position: absolute;
        right: 4px;
        top: 3px;
        width: 36px;
        height: 36px;
        background: #f58220;
        color: #fff;
        border: none;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: 0.3s;
    }

        .search-btn-icon:hover {
            background: #d66b15;
        }

    /* Action Icons */
    .header-actions {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 20px;
    }

    .btn-icon {
        position: relative;
        color: #333;
        font-size: 1.5rem;
        transition: 0.2s;
        display: inline-flex;
        align-items: center;
        text-decoration: none;
        cursor: pointer; /* Thêm con trỏ chuột */
    }

        .btn-icon:hover {
            color: #f58220;
        }

    /* BADGE SỐ LƯỢNG (MÀU ĐỎ) */
    .badge-counter {
        position: absolute;
        top: -5px;
        right: -8px;
        background-color: #dc3545; /* Màu đỏ */
        color: #fff;
        font-size: 10px;
        font-weight: 700;
        min-width: 18px;
        height: 18px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid #fff;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    /* FIX LỖI BỊ CHE 2: Cấu hình Dropdown chuẩn */
    .dropdown {
        position: relative; /* Để menu con định vị theo nút cha */
    }

    .user-dropdown-menu {
        border: none;
        box-shadow: 0 5px 25px rgba(0,0,0,0.2); /* Bóng đổ đậm hơn chút để tách biệt */
        border-radius: 8px;
        margin-top: 10px !important;
        min-width: 220px;
        padding: 0;
        overflow: hidden;
        /* Định vị tuyệt đối và z-index cao */
        position: absolute;
        top: 100%;
        right: 0;
        left: auto;
        z-index: 1100 !important;
        background-color: #fff;
    }

    .user-header {
        background: #f58220;
        color: white;
        padding: 15px;
    }

    .dropdown-item {
        padding: 10px 20px;
        font-size: 14px;
        color: #555;
        transition: 0.2s;
        border-bottom: 1px solid #f9f9f9;
        background-color: transparent; /* Đảm bảo nền trong suốt */
    }

        .dropdown-item:hover {
            background: #fff5eb;
            color: #f58220;
            padding-left: 25px;
        }

        .dropdown-item i {
            width: 20px;
            text-align: center;
            margin-right: 10px;
        }
</style>

<div class="header-top py-2 d-none d-lg-block">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <i class="fas fa-envelope me-2 text-warning"></i> hotro@ntnstore.com
                <span class="mx-2 text-muted">|</span>
                <i class="fas fa-phone-alt me-2 text-warning"></i> 0968686868
            </div>
            <div class="small text-muted">Miễn phí vận chuyển cho đơn hàng từ 1500000VNĐ</div>
        </div>
    </div>
</div>

<div class="header-main">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-3 col-6">
                <a href="/" class="text-decoration-none d-flex align-items-center">
                    <span class="h2 text-uppercase fw-bold text-dark mb-0">NTN</span>
                    <span class="h2 text-uppercase fw-bold text-warning mb-0">Store</span>
                </a>
            </div>

            <div class="col-lg-6 d-none d-lg-block">
                <form asp-controller="Product" asp-action="Index" method="get" class="search-wrap">
                    <input type="text" name="search" class="search-box" placeholder="Bạn tìm gì hôm nay?" value="@ViewContext.HttpContext.Request.Query["search"]">
                    <button type="submit" class="search-btn-icon"><i class="fas fa-search"></i></button>
                </form>
            </div>

            <div class="col-lg-3 col-6 header-actions">

                <div class="dropdown">
                    <a href="#" class="btn-icon" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="far fa-user"></i>
                    </a>
                    <ul class="dropdown-menu user-dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                        @if (SignInManager.IsSignedIn(User))
                        {
                            <li>
                                <div class="user-header">
                                    <div class="fw-bold">Xin chào,</div>
                                    <div class="small text-truncate" style="max-width: 180px;">@User.Identity?.Name</div>
                                </div>
                            </li>
                            <li><a class="dropdown-item" asp-area="Identity" asp-page="/Account/Manage/Index"><i class="fas fa-user-cog"></i> Tài khoản của tôi</a></li>
                            <li><a class="dropdown-item" asp-controller="Order" asp-action="Index"><i class="fas fa-box-open"></i> Đơn mua</a></li>
                            <li>
                                <form asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })" method="post" class="m-0">
                                    <button type="submit" class="dropdown-item text-danger"><i class="fas fa-sign-out-alt"></i> Đăng xuất</button>
                                </form>
                            </li>
                        }
                        else
                        {
                            <li><div class="user-header fw-bold">Tài khoản</div></li>
                            <li><a class="dropdown-item" asp-area="Identity" asp-page="/Account/Login"><i class="fas fa-sign-in-alt"></i> Đăng nhập</a></li>
                            <li><a class="dropdown-item" asp-area="Identity" asp-page="/Account/Register"><i class="fas fa-user-plus"></i> Đăng ký</a></li>
                        }
                    </ul>
                </div>

                <a asp-controller="Wishlist" asp-action="Index" class="btn-icon position-relative" title="Yêu thích">
                    <i class="far fa-heart"></i>
                    @await Component.InvokeAsync("WishlistBadge")
                </a>

                <a asp-controller="Cart" asp-action="Index" class="btn-icon position-relative" title="Giỏ hàng">
                    <i class="fas fa-shopping-bag"></i>
                    @await Component.InvokeAsync("CartBadge")
                </a>

            </div>
        </div>
    </div>
</div>